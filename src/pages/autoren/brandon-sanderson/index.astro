---
import { getCollection } from "astro:content"
import PageLayout from "@layouts/PageLayout.astro"
import ArrowCard from "@components/ArrowCard"
import { SITE, SOCIALS } from "@consts"

// Fetch author's data
const author = (await getCollection("bookauthor")).find(author => author.data.name === "Brandon Sanderson")

// Fetch works data
const posts = (await getCollection("blog"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3)

const projects = (await getCollection("projects"))
  .filter(project => !project.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3)

const tags = Array.from(new Set([
  ...posts.flatMap(post => post.data.tags || []),
  ...projects.flatMap(project => project.data.tags || [])
]));
---
<PageLayout title={`Author Profile: ${author.data.name}`} description={`Overview of ${author.data.name}'s works and related tags`}>
  <!-- Author Image and Biography -->
  <section class="relative w-full p-5 flex flex-col items-center bg-gradient-to-r from-blue-500 via-green-500 to-yellow-500 text-white rounded-lg shadow-lg mb-16">
    <img src={author.data.imageUrl} alt="Author" class="rounded-full w-32 h-32 mb-4 border-4 border-white shadow-md" />
    <div class="text-center">
      <h1 class="text-3xl font-bold">{author.data.name}</h1>
      <p class="text-lg mt-2">
        {author.data.biography}
      </p>
    </div>
  </section>

  <!-- Works Overview -->
  <section class="p-5 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Blog Posts -->
    <div class="col-span-1 flex flex-col space-y-4 bg-white p-4 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold text-center mb-2">Recent Blog Posts</h2>
      <ul class="space-y-4">
        {posts.map((post) => (
          <li>
            <ArrowCard entry={post} />
          </li>
        ))}
      </ul>
      <a href="/blog" class="mt-4 text-blue-500 hover:text-blue-700 text-center block">View All Blog Posts</a>
    </div>

    <!-- Projects -->
    <div class="col-span-1 flex flex-col space-y-4 bg-white p-4 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold text-center mb-2">Recent Projects</h2>
      <ul class="space-y-4">
        {projects.map((project) => (
          <li>
            <ArrowCard entry={project} />
          </li>
        ))}
      </ul>
      <a href="/projects" class="mt-4 text-blue-500 hover:text-blue-700 text-center block">View All Projects</a>
    </div>
  </section>

  <!-- Tags Overview -->
  <section class="p-5">
    <h2 class="text-xl font-semibold text-center mb-4">Related Tags</h2>
    <div class="flex flex-wrap justify-center gap-2">
      {tags.map(tag => (
        <span class="px-3 py-1 rounded-full bg-gray-200 text-gray-700">
          {tag}
        </span>
      ))}
    </div>
  </section>

  <!-- Social Media Links -->
  <section class="p-5">
    <h2 class="text-xl font-semibold text-center mb-4">Let's Connect</h2>
    <div class="flex justify-center gap-4">
      {SOCIALS.map(social => (
        <a href={social.HREF} target="_blank" class="text-blue-500 hover:text-blue-700">
          {social.NAME}
        </a>
      ))}
    </div>
  </section>
</PageLayout>
